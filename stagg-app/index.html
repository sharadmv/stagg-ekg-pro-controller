<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#18181b">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/svg+xml" href="icon-v2.svg">
    <title>Stagg EKG Pro</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        zinc: {
                            850: '#1f1f23',
                            900: '#18181b',
                            950: '#09090b',
                        }
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-zinc-950 text-zinc-100 font-sans min-h-screen selection:bg-blue-500 selection:text-white pb-12">

    <div class="max-w-md mx-auto px-4 py-6 sm:py-10">
        
        <!-- Header -->
        <header class="mb-10 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-zinc-800 rounded-xl flex items-center justify-center shadow-lg border border-zinc-700/50">
                    <span class="text-xl">☕</span>
                </div>
                <div>
                    <h1 class="text-lg font-bold tracking-tight text-white leading-tight">EKG Pro</h1>
                    <div class="flex items-center gap-2 mt-0.5">
                        <div id="status-dot" class="w-2 h-2 rounded-full bg-red-500 shadow-[0_0_8px_rgba(239,68,68,0.6)] transition-colors duration-500"></div>
                        <p id="connection-status" class="text-xs font-medium text-zinc-400 tracking-wide uppercase">Disconnected</p>
                    </div>
                </div>
            </div>
            <button id="refresh-btn" class="hidden text-zinc-500 hover:text-white transition-colors p-2" title="Refresh">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.3"/></svg>
            </button>
            <button id="debug-btn" class="text-zinc-500 hover:text-white transition-colors p-2" title="Debug Console">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 16a4 4 0 1 0 0-8 4 4 0 0 0 0 8z"/><path d="M12 2v4"/><path d="M12 18v4"/><path d="m4.9 4.9 2.9 2.9"/><path d="m16.2 16.2 2.9 2.9"/><path d="M2 12h4"/><path d="M18 12h4"/><path d="m4.9 19.1 2.9-2.9"/><path d="m16.2 7.8 2.9-2.9"/></svg>
            </button>
        </header>

        <!-- Debug Overlay -->
        <div id="debug-overlay" class="hidden fixed inset-0 z-50 bg-zinc-950/95 backdrop-blur-md overflow-hidden flex flex-col">
            <div class="flex items-center justify-between p-4 border-b border-zinc-800 bg-zinc-900/50">
                <h2 class="text-sm font-semibold text-white flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 16a4 4 0 1 0 0-8 4 4 0 0 0 0 8z"/><path d="M12 2v4"/><path d="M12 18v4"/><path d="m4.9 4.9 2.9 2.9"/><path d="m16.2 16.2 2.9 2.9"/><path d="M2 12h4"/><path d="M18 12h4"/><path d="m4.9 19.1 2.9-2.9"/><path d="m16.2 7.8 2.9-2.9"/></svg>
                    Debug Console
                </h2>
                <button id="close-debug-btn" class="text-zinc-400 hover:text-white p-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>

            <div class="flex items-center justify-between p-4 bg-zinc-900 border-b border-zinc-800">
                <label class="flex items-center cursor-pointer">
                    <div class="relative">
                        <input type="checkbox" id="debug-mode-toggle" class="sr-only">
                        <div class="w-10 h-6 bg-zinc-700 rounded-full shadow-inner"></div>
                        <div class="dot absolute left-1 top-1 w-4 h-4 bg-white rounded-full transition transform duration-200 ease-in-out"></div>
                    </div>
                    <div class="ml-3 text-xs font-medium text-zinc-300">
                        Enable Logging
                    </div>
                </label>
                <button id="clear-logs-btn" class="text-xs bg-zinc-800 hover:bg-zinc-700 text-zinc-300 px-3 py-1.5 rounded-lg border border-zinc-700 transition">
                    Clear
                </button>
            </div>

            <div class="flex-1 overflow-auto p-4 font-mono text-[10px] leading-relaxed" id="debug-container">
                <div class="text-zinc-500 italic mb-2">Logs will appear here when enabled...</div>
                <pre id="debug-console-logs" class="text-green-400"></pre>
            </div>
            <style>
                #debug-mode-toggle:checked ~ .dot {
                    transform: translateX(100%);
                    background-color: #4ade80;
                }
                #debug-mode-toggle:checked ~ .bg-zinc-700 {
                    background-color: #3f3f46;
                }
            </style>
        </div>

        <!-- Scan & Connect Section -->
        <div id="scan-section" class="bg-zinc-900/50 border border-zinc-800/50 backdrop-blur-xl rounded-3xl p-6 shadow-2xl mb-6 ring-1 ring-white/5 relative overflow-hidden">
            
            <!-- Idle / Scan State -->
            <div id="scan-content" class="text-center py-6 transition-opacity duration-300">
                <div class="w-16 h-16 bg-zinc-800 rounded-full flex items-center justify-center mx-auto mb-4 text-zinc-500 shadow-inner border border-zinc-700/30">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12.55a11 11 0 0 1 14.08 0"/><path d="M1.42 9a16 16 0 0 1 21.16 0"/><path d="M8.53 16.11a6 6 0 0 1 6.95 0"/><line x1="12" y1="20" x2="12.01" y2="20"/></svg>
                </div>
                <h2 class="text-xl font-semibold text-white mb-2">Connect Device</h2>
                <p class="text-sm text-zinc-400 mb-6 leading-relaxed max-w-[260px] mx-auto">
                    Make sure your kettle is plugged in and within range to start controlling it.
                </p>
                <button id="connect-btn" class="w-full bg-white text-black hover:bg-zinc-200 font-bold py-3.5 px-6 rounded-2xl transition-all active:scale-[0.98] shadow-lg shadow-white/10">
                    Find Kettle
                </button>
                <div id="error-msg" class="hidden mt-4 p-3 bg-red-500/10 border border-red-500/20 text-red-400 text-xs rounded-xl text-left"></div>
            </div>

            <!-- Connecting / Loading State -->
            <div id="connecting-content" class="hidden absolute inset-0 flex flex-col items-center justify-center bg-zinc-900/95 backdrop-blur-sm z-10 transition-opacity duration-300">
                <div class="relative mb-6">
                    <!-- Radar Ping -->
                    <div class="absolute inset-0 rounded-full bg-blue-500/30 animate-ping"></div>
                    <div class="absolute inset-0 rounded-full bg-blue-500/20 animate-pulse delay-75"></div>
                    
                    <!-- Center Icon -->
                    <div class="relative w-16 h-16 bg-zinc-900 rounded-full flex items-center justify-center border border-blue-500/50 shadow-[0_0_15px_rgba(59,130,246,0.5)] z-10">
                        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-400"><path d="M12 2v4"/><path d="m16.2 7.8 2.9-2.9"/><path d="M18 12h4"/><path d="m16.2 16.2 2.9 2.9"/><path d="M12 18v4"/><path d="m4.9 19.1 2.9-2.9"/><path d="M2 12h4"/><path d="m4.9 4.9 2.9 2.9"/></svg>
                    </div>
                </div>
                <h3 class="text-lg font-semibold text-white mb-1">Connecting...</h3>
                <p id="connecting-status" class="text-xs text-blue-400 font-mono tracking-wide uppercase">Establishing Link</p>
            </div>

        </div>

        <!-- Dashboard -->
        <div id="dashboard" class="hidden space-y-4">
            
            <!-- Disconnect Action (Small) -->
            <div class="flex justify-end">
                 <button id="disconnect-btn" class="hidden text-xs font-medium text-red-400 hover:text-red-300 transition-colors px-2 py-1">
                    Disconnect
                </button>
            </div>

            <!-- Schedule Card (Hero) -->
            <div class="bg-zinc-900 border border-zinc-800 rounded-[2rem] p-6 sm:p-8 shadow-2xl relative overflow-hidden">
                 <!-- Background Glow -->
                <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-48 h-48 bg-emerald-500/10 blur-[80px] rounded-full pointer-events-none"></div>

                <div class="relative z-10">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xs font-semibold uppercase tracking-widest text-zinc-500 flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-emerald-500"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                            Auto-Start
                        </h2>
                        <!-- Mode Toggle (Visual) -->
                        <div class="relative">
                             <select id="schedule-mode" class="bg-zinc-950 text-xs font-medium text-emerald-400 rounded-lg py-1.5 px-3 border border-emerald-500/20 focus:outline-none focus:border-emerald-500/50 appearance-none pr-8 cursor-pointer shadow-sm">
                                <option value="off">Disabled</option>
                                <option value="once">Run Once</option>
                                <option value="daily">Daily</option>
                            </select>
                             <div class="absolute right-2 top-2 pointer-events-none text-emerald-500/50">
                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
                            </div>
                        </div>
                    </div>

                    <!-- Giant Time Input -->
                    <div class="flex flex-col items-center mb-6 relative group">
                        <input type="time" id="sched-time" value="08:00" class="bg-transparent text-5xl sm:text-6xl font-light text-white border-none p-0 focus:ring-0 appearance-none text-center w-full cursor-pointer hover:text-emerald-50 transition-colors">
                        <div class="text-[10px] text-zinc-600 font-medium tracking-wider uppercase mt-2 group-hover:text-zinc-500 transition-colors">Start Time</div>
                    </div>

                    <!-- Temp Control (Schedule) -->
                    <div class="bg-zinc-950/40 rounded-2xl p-5 border border-zinc-800/50 mb-6">
                         <div class="flex items-center justify-between mb-4">
                            <span class="text-xs uppercase tracking-wider text-zinc-500">Target Temp</span>
                            <div class="flex items-baseline gap-1">
                                <span id="display-schedule-temp" class="text-3xl font-light text-white tabular-nums">--</span>
                                <span class="text-sm text-zinc-600">°C</span>
                            </div>
                        </div>
                        <div class="w-full">
                             <input type="range" id="schedule-temp" min="40" max="100" step="1" 
                               class="slider-track w-full h-10 bg-transparent cursor-pointer appearance-none focus:outline-none">
                            <div class="flex justify-between w-full px-1 text-[10px] font-medium text-zinc-600 font-mono mt-1">
                                <span>40°C</span>
                                <span>100°C</span>
                            </div>
                        </div>
                    </div>

                    <button id="save-schedule-btn" class="w-full bg-emerald-600 hover:bg-emerald-500 text-white font-bold py-4 rounded-xl transition-all active:scale-[0.98] shadow-lg shadow-emerald-900/20 flex items-center justify-center gap-2">
                        <span>Save Schedule</span>
                    </button>
                     <p id="schedule-status" class="text-center text-[10px] text-emerald-500 font-medium mt-2 h-4 opacity-0 transition-opacity">Saved Successfully</p>
                </div>
            </div>

            <!-- Manual Temp Card (Secondary) -->
            <div class="bg-zinc-900 border border-zinc-800 rounded-3xl p-6 shadow-lg">
                 <div class="flex items-center justify-between mb-4">
                    <h2 class="text-xs font-semibold uppercase tracking-widest text-zinc-500">Manual Control</h2>
                    <div class="flex items-center gap-3">
                        <button id="turn-on-btn" class="bg-orange-600 hover:bg-orange-500 text-white text-xs font-bold py-1.5 px-3 rounded-lg transition-colors shadow-lg shadow-orange-900/20 active:scale-95">
                            Turn On
                        </button>
                        <div class="flex items-baseline gap-1">
                            <span id="display-target-temp" class="text-2xl font-light text-white tabular-nums">--</span>
                            <span class="text-xs text-zinc-600">°C</span>
                        </div>
                    </div>
                </div>
                
                <div class="w-full">
                    <input type="range" id="temp-slider" min="40" max="100" step="1" 
                            class="slider-track w-full h-10 bg-transparent cursor-pointer appearance-none focus:outline-none">
                        <div class="flex justify-between w-full px-1 text-[10px] font-medium text-zinc-600 font-mono mt-1">
                        <span>40°C</span>
                        <span>100°C</span>
                    </div>
                </div>
            </div>

            <!-- Settings / Info Grid -->
            <div class="grid grid-cols-2 gap-4">
                <!-- Hold Time -->
                <div class="bg-zinc-900 border border-zinc-800 rounded-3xl p-5 shadow-lg">
                    <label class="block text-[10px] uppercase tracking-wider text-zinc-500 mb-3">Hold Time</label>
                    <div class="flex flex-col gap-3">
                        <select id="hold-time" class="bg-zinc-950 border border-zinc-800 text-white text-sm rounded-lg block w-full p-2.5 focus:ring-blue-500 focus:border-blue-500">
                            <option value="0">Off</option>
                            <option value="15">15 min</option>
                            <option value="30">30 min</option>
                            <option value="45">45 min</option>
                            <option value="60">60 min</option>
                        </select>
                        <button id="set-hold-btn" class="text-xs bg-zinc-800 hover:bg-zinc-700 text-white py-2 rounded-lg transition">Set</button>
                    </div>
                </div>

                <!-- Info -->
                <div class="bg-zinc-900 border border-zinc-800 rounded-3xl p-5 shadow-lg flex flex-col justify-between">
                    <div>
                        <label class="block text-[10px] uppercase tracking-wider text-zinc-500 mb-2">Device Info</label>
                        <div class="space-y-1">
                            <div class="flex justify-between text-xs">
                                <span class="text-zinc-600">Alt</span>
                                <span class="text-zinc-300"><span id="info-altitude">--</span>m</span>
                            </div>
                            <div class="flex justify-between text-xs">
                                <span class="text-zinc-600">Clock</span>
                                <span class="text-zinc-300" id="info-clock">--:--</span>
                            </div>
                             <div class="flex justify-between text-xs">
                                <span class="text-zinc-600">Lang</span>
                                <span class="text-zinc-300 truncate max-w-[50px]" id="info-language">--</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Debug Toggle -->
             <div class="text-center pt-4">
                <details class="group">
                    <summary class="text-[10px] text-zinc-700 cursor-pointer hover:text-zinc-500 transition list-none">
                        View Raw Data
                    </summary>
                    <pre id="debug-log" class="text-[10px] font-mono mt-2 text-zinc-600 bg-zinc-900/50 p-2 rounded-lg overflow-x-auto text-left border border-zinc-800/50">Waiting...</pre>
                </details>
            </div>
        </div>
    </div>

    <!-- Hidden legacy inputs for compatibility if JS tries to grab them directly before finding new ones, though our JS handles nulls now. 
         Actually, we removed them from the UI, but our JS gracefully handles missing elements. We can omit them. 
    -->

    <script src="app.js"></script>
    <script>
        // Inline script to handle specific UI updates for the new design (visual only)
        // The main logic remains in app.js
        const statusEl = document.getElementById('connection-status');
        const dotEl = document.getElementById('status-dot');
        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                if (mutation.type === 'childList' || mutation.type === 'characterData') {
                    const text = statusEl.innerText.toLowerCase();
                    if (text.includes('connected') && !text.includes('dis')) {
                        dotEl.classList.remove('bg-red-500', 'shadow-[0_0_8px_rgba(239,68,68,0.6)]');
                        dotEl.classList.add('bg-green-500', 'shadow-[0_0_8px_rgba(34,197,94,0.6)]');
                    } else {
                        dotEl.classList.remove('bg-green-500', 'shadow-[0_0_8px_rgba(34,197,94,0.6)]');
                        dotEl.classList.add('bg-red-500', 'shadow-[0_0_8px_rgba(239,68,68,0.6)]');
                    }
                }
            });
        });
        observer.observe(statusEl, { childList: true, subtree: true, characterData: true });
    </script>
</body>
</html>